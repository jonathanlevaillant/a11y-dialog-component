{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/a11y-dialog-component.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;ACAA;;;AAGA,IAAM,UAAW,YAAM;AACrB,MAAM,cAAc;AAClB,mBAAe,SADG;AAElB,0BAAsB,gBAFJ;AAGlB,2BAAuB;AAHL,GAApB;;AAMA,MAAM,YAAY;AAChB,SAAK,CADW;AAEhB,WAAO,EAFS;AAGhB,YAAQ;AAHQ,GAAlB;;AAMA,MAAM,qBAAqB,CACzB,QADyB,EAEzB,4CAFyB,EAGzB,wBAHyB,EAIzB,0BAJyB,EAKzB,wBALyB,EAMzB,QANyB,EAOzB,QAPyB,EAQzB,OARyB,EASzB,mBATyB,EAUzB,iCAVyB,CAA3B;;AAbqB,MA0Bf,MA1Be;AA2BnB,oBAAY,OAAZ,EAAqB;AAAA;;AACnB,WAAK,OAAL,GAAe,QAAQ,OAAvB;AACA,WAAK,MAAL,GAAc,SAAS,cAAT,CAAwB,QAAQ,MAAhC,CAAd;AACA,WAAK,eAAL,GAAuB,KAAK,MAAL,CAAY,gBAAZ,CAA6B,gBAA7B,CAAvB;;AAEA,WAAK,iBAAL,GAAyB,KAAK,MAAL,CAAY,gBAAZ,CAA6B,kBAA7B,CAAzB;;AALmB,8CAMY,KAAK,iBANjB;;AAMlB,WAAK,qBANa;;AAOnB,WAAK,oBAAL,GAA4B,KAAK,iBAAL,CAAuB,KAAK,iBAAL,CAAuB,MAAvB,GAAgC,CAAvD,CAA5B;;AAPmB,kCASL,SAAS,sBAAT,CAAgC,QAAQ,aAAxC,CATK;;AAAA;;AASlB,WAAK,IATa;;AAUnB,WAAK,WAAL,GAAmB,SAAS,sBAAT,CAAgC,QAAQ,oBAAxC,CAAnB;AACA,WAAK,qBAAL,GAA6B,QAAQ,qBAArC;;AAEA,WAAK,QAAL,GAAgB,QAAQ,QAAxB;AACA,WAAK,MAAL,GAAc,QAAQ,MAAtB;;AAEA,WAAK,IAAL,GAAY,KAAK,IAAL,CAAU,IAAV,CAAe,IAAf,CAAZ;AACA,WAAK,KAAL,GAAa,KAAK,KAAL,CAAW,IAAX,CAAgB,IAAhB,CAAb;AACA,WAAK,OAAL,GAAe,KAAK,OAAL,CAAa,IAAb,CAAkB,IAAlB,CAAf;AACA,WAAK,SAAL,GAAiB,KAAK,SAAL,CAAe,IAAf,CAAoB,IAApB,CAAjB;;AAEA,UAAI,KAAK,MAAT,EAAiB;AACf,aAAK,IAAL;AACD;AACF;;AAnDkB;AAAA;AAAA,gCAqDT,KArDS,EAqDF;AACf,YAAI,MAAM,QAAN,IAAkB,MAAM,MAAN,KAAiB,KAAK,qBAA5C,EAAmE;AACjE,gBAAM,cAAN;AACA,eAAK,oBAAL,CAA0B,KAA1B;AACD;;AAED,YAAI,CAAC,MAAM,QAAP,IAAmB,MAAM,MAAN,KAAiB,KAAK,oBAA7C,EAAmE;AACjE,gBAAM,cAAN;AACA,eAAK,qBAAL,CAA2B,KAA3B;AACD;AACF;AA/DkB;AAAA;AAAA,iCAiER;AAAA;;AACT,YAAI,KAAK,iBAAL,CAAuB,MAAvB,GAAgC,CAApC,EAAuC;AACrC,iBAAO,UAAP,CAAkB,YAAM;AACtB,kBAAK,qBAAL,CAA2B,KAA3B;AACD,WAFD,EAEG,GAFH;AAGD;AACF;AAvEkB;AAAA;AAAA,2BAyEd,KAzEc,EAyEP;AACV,YAAI,KAAJ,EAAW,MAAM,cAAN;;AAEX,aAAK,MAAL,CAAY,eAAZ,CAA4B,aAA5B;;AAEA,YAAI,CAAC,KAAK,QAAV,EAAoB;AAClB,eAAK,IAAL,CAAU,SAAV,CAAoB,GAApB,CAAwB,KAAK,qBAA7B;;AAEA,gBAAM,SAAN,CAAgB,OAAhB,CAAwB,IAAxB,CAA6B,KAAK,WAAlC,EAA+C,UAAC,UAAD,EAAgB;AAC7D,uBAAW,YAAX,CAAwB,aAAxB,EAAuC,IAAvC;AACA,uBAAW,YAAX,CAAwB,OAAxB,EAAiC,EAAjC;AACD,WAHD;AAID;;AAED;AACA,aAAK,QAAL;;AAEA;AACA,aAAK,iBAAL;AACD;AA5FkB;AAAA;AAAA,4BA8Fb,KA9Fa,EA8FN;AACX,YAAI,KAAJ,EAAW,MAAM,cAAN;;AAEX,aAAK,MAAL,CAAY,YAAZ,CAAyB,aAAzB,EAAwC,IAAxC;;AAEA,YAAI,CAAC,KAAK,QAAV,EAAoB;AAClB,eAAK,IAAL,CAAU,SAAV,CAAoB,MAApB,CAA2B,KAAK,qBAAhC;;AAEA,gBAAM,SAAN,CAAgB,OAAhB,CAAwB,IAAxB,CAA6B,KAAK,WAAlC,EAA+C,UAAC,UAAD,EAAgB;AAC7D,uBAAW,eAAX,CAA2B,aAA3B;AACA,uBAAW,eAAX,CAA2B,OAA3B;AACD,WAHD;AAID;;AAED;AACA,YAAI,KAAK,OAAT,EAAkB;AAChB,eAAK,OAAL,CAAa,KAAb;AACD;;AAED;AACA,aAAK,oBAAL;AACD;AAnHkB;AAAA;AAAA,0CAqHC;AAAA;;AAClB,aAAK,MAAL,CAAY,gBAAZ,CAA6B,OAA7B,EAAsC,KAAK,OAA3C;AACA,aAAK,MAAL,CAAY,gBAAZ,CAA6B,YAA7B,EAA2C,KAAK,OAAhD;AACA,aAAK,MAAL,CAAY,gBAAZ,CAA6B,SAA7B,EAAwC,KAAK,SAA7C;AACA,aAAK,eAAL,CAAqB,OAArB,CAA6B,UAAC,cAAD,EAAoB;AAC/C,yBAAe,gBAAf,CAAgC,OAAhC,EAAyC,OAAK,KAA9C;AACD,SAFD;AAGD;AA5HkB;AAAA;AAAA,6CA8HI;AAAA;;AACrB,aAAK,MAAL,CAAY,mBAAZ,CAAgC,OAAhC,EAAyC,KAAK,OAA9C;AACA,aAAK,MAAL,CAAY,mBAAZ,CAAgC,YAAhC,EAA8C,KAAK,OAAnD;AACA,aAAK,MAAL,CAAY,mBAAZ,CAAgC,SAAhC,EAA2C,KAAK,SAAhD;AACA,aAAK,eAAL,CAAqB,OAArB,CAA6B,UAAC,cAAD,EAAoB;AAC/C,yBAAe,mBAAf,CAAmC,OAAnC,EAA4C,OAAK,KAAjD;AACD,SAFD;AAGD;AArIkB;AAAA;AAAA,8BAuIX,KAvIW,EAuIJ;AACb,YAAI,MAAM,MAAN,KAAiB,KAAK,MAA1B,EAAkC,KAAK,KAAL,CAAW,KAAX;AACnC;AAzIkB;AAAA;AAAA,gCA2IT,KA3IS,EA2IF;AACf,YAAI,MAAM,KAAN,KAAgB,UAAU,MAA9B,EAAsC,KAAK,KAAL,CAAW,KAAX;AACtC,YAAI,MAAM,KAAN,KAAgB,UAAU,KAA1B,IAAmC,MAAM,MAAN,CAAa,YAAb,CAA0B,cAA1B,CAAvC,EAAkF,KAAK,KAAL,CAAW,KAAX;AAClF,YAAI,MAAM,KAAN,KAAgB,UAAU,GAA9B,EAAmC,KAAK,SAAL,CAAe,KAAf;AACpC;AA/IkB;AAAA;AAAA,+BAiJV;AAAA;;AACP,YAAI,KAAK,OAAT,EAAkB;AAChB,eAAK,OAAL,CAAa,gBAAb,CAA8B,OAA9B,EAAuC,KAAK,IAA5C;AACA,eAAK,OAAL,CAAa,gBAAb,CAA8B,SAA9B,EAAyC,UAAC,KAAD,EAAW;AAClD,gBAAI,MAAM,KAAN,KAAgB,UAAU,KAA9B,EAAqC;AACnC,qBAAK,IAAL,CAAU,KAAV;AACD;AACF,WAJD;AAKD;AACF;AA1JkB;;AAAA;AAAA;;AA6JrB,MAAI,eAAe,IAAnB;;AAEA,MAAM,OAAO,SAAP,IAAO,CAAC,MAAD,EAAkC;AAAA,QAAzB,MAAyB,uEAAhB,WAAgB;;AAC7C,QAAM,UAAU,OAAO,MAAP,CAAc,EAAd,EAAkB,WAAlB,EAA+B,MAA/B,CAAhB;AACA,YAAQ,MAAR,GAAiB,MAAjB;AACA,YAAQ,OAAR,GAAkB,OAAO,OAAP,GAAiB,SAAS,cAAT,CAAwB,OAAO,OAA/B,CAAjB,GAA2D,KAA7E;;AAEA,YAAQ,QAAR,GAAmB,OAAO,QAAP,IAAmB,KAAtC;AACA,YAAQ,MAAR,GAAiB,IAAjB;;AAEA,mBAAe,IAAI,MAAJ,CAAW,OAAX,CAAf;AACA,iBAAa,MAAb;AACD,GAVD;;AAYA,MAAM,QAAQ,SAAR,KAAQ,GAAM;AAClB,iBAAa,KAAb;AACD,GAFD;;AAIA,MAAM,SAAS,SAAT,MAAS,GAAmE;AAAA,QAAlE,SAAkE,uEAAtD,2BAAsD;AAAA,QAAzB,MAAyB,uEAAhB,WAAgB;;AAChF,QAAM,WAAW,SAAS,gBAAT,CAA0B,SAA1B,CAAjB;AACA,QAAM,UAAU,OAAO,MAAP,CAAc,EAAd,EAAkB,WAAlB,EAA+B,MAA/B,CAAhB;;AAEA,aAAS,OAAT,CAAiB,UAAC,OAAD,EAAa;AAC5B,cAAQ,OAAR,GAAkB,OAAlB;AACA,cAAQ,MAAR,GAAiB,QAAQ,OAAR,CAAgB,MAAjC;;AAEA,cAAQ,QAAR,GAAmB,QAAQ,OAAR,CAAgB,MAAhB,KAA2B,MAA9C;AACA,cAAQ,MAAR,GAAiB,QAAQ,OAAR,CAAgB,IAAhB,KAAyB,MAA1C;;AAEA,UAAM,SAAS,IAAI,MAAJ,CAAW,OAAX,CAAf;AACA,aAAO,MAAP;AACD,KATD;AAUD,GAdD;;AAgBA,SAAO,EAAE,UAAF,EAAQ,YAAR,EAAe,cAAf,EAAP;AACD,CAhMe,EAAhB;;kBAkMe,O","file":"a11y-dialog-component.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* dialogs\n ========================================================================== */\n\nconst Dialogs = (() => {\n  const CLASS_NAMES = {\n    pageClassName: 'js-page',\n    inertLayersClassName: 'js-inert-layer',\n    disabledPageClassName: 'is-inactive',\n  };\n\n  const KEY_CODES = {\n    tab: 9,\n    enter: 13,\n    escape: 27,\n  };\n\n  const FOCUSABLE_ELEMENTS = [\n    '[href]',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    'button:not([disabled])',\n    'iframe',\n    'object',\n    'embed',\n    '[contenteditable]',\n    '[tabindex]:not([tabindex^=\"-\"])',\n  ];\n\n  class Dialog {\n    constructor(options) {\n      this.trigger = options.trigger;\n      this.dialog = document.getElementById(options.dialog);\n      this.dismissTriggers = this.dialog.querySelectorAll('[data-dismiss]');\n\n      this.focusableElements = this.dialog.querySelectorAll(FOCUSABLE_ELEMENTS);\n      [this.firstFocusableElement] = this.focusableElements;\n      this.lastFocusableElement = this.focusableElements[this.focusableElements.length - 1];\n\n      [this.page] = document.getElementsByClassName(options.pageClassName);\n      this.inertLayers = document.getElementsByClassName(options.inertLayersClassName);\n      this.disabledPageClassName = options.disabledPageClassName;\n\n      this.isNested = options.isNested;\n      this.isOpen = options.isOpen;\n\n      this.open = this.open.bind(this);\n      this.close = this.close.bind(this);\n      this.onClick = this.onClick.bind(this);\n      this.onKeydown = this.onKeydown.bind(this);\n\n      if (this.isOpen) {\n        this.open();\n      }\n    }\n\n    focusTrap(event) {\n      if (event.shiftKey && event.target === this.firstFocusableElement) {\n        event.preventDefault();\n        this.lastFocusableElement.focus();\n      }\n\n      if (!event.shiftKey && event.target === this.lastFocusableElement) {\n        event.preventDefault();\n        this.firstFocusableElement.focus();\n      }\n    }\n\n    setFocus() {\n      if (this.focusableElements.length > 0) {\n        window.setTimeout(() => {\n          this.firstFocusableElement.focus();\n        }, 100);\n      }\n    }\n\n    open(event) {\n      if (event) event.preventDefault();\n\n      this.dialog.removeAttribute('aria-hidden');\n\n      if (!this.isNested) {\n        this.page.classList.add(this.disabledPageClassName);\n\n        Array.prototype.forEach.call(this.inertLayers, (inertLayer) => {\n          inertLayer.setAttribute('aria-hidden', true);\n          inertLayer.setAttribute('inert', '');\n        });\n      }\n\n      // setting focus on the first focusable element\n      this.setFocus();\n\n      // add event listeners\n      this.addEventListeners();\n    }\n\n    close(event) {\n      if (event) event.preventDefault();\n\n      this.dialog.setAttribute('aria-hidden', true);\n\n      if (!this.isNested) {\n        this.page.classList.remove(this.disabledPageClassName);\n\n        Array.prototype.forEach.call(this.inertLayers, (inertLayer) => {\n          inertLayer.removeAttribute('aria-hidden');\n          inertLayer.removeAttribute('inert');\n        });\n      }\n\n      // restoring focus\n      if (this.trigger) {\n        this.trigger.focus();\n      }\n\n      // remove event listeners\n      this.removeEventListeners();\n    }\n\n    addEventListeners() {\n      this.dialog.addEventListener('click', this.onClick);\n      this.dialog.addEventListener('touchstart', this.onClick);\n      this.dialog.addEventListener('keydown', this.onKeydown);\n      this.dismissTriggers.forEach((dismissTrigger) => {\n        dismissTrigger.addEventListener('click', this.close);\n      });\n    }\n\n    removeEventListeners() {\n      this.dialog.removeEventListener('click', this.onClick);\n      this.dialog.removeEventListener('touchstart', this.onClick);\n      this.dialog.removeEventListener('keydown', this.onKeydown);\n      this.dismissTriggers.forEach((dismissTrigger) => {\n        dismissTrigger.removeEventListener('click', this.close);\n      });\n    }\n\n    onClick(event) {\n      if (event.target === this.dialog) this.close(event);\n    }\n\n    onKeydown(event) {\n      if (event.which === KEY_CODES.escape) this.close(event);\n      if (event.which === KEY_CODES.enter && event.target.hasAttribute('data-dismiss')) this.close(event);\n      if (event.which === KEY_CODES.tab) this.focusTrap(event);\n    }\n\n    render() {\n      if (this.trigger) {\n        this.trigger.addEventListener('click', this.open);\n        this.trigger.addEventListener('keydown', (event) => {\n          if (event.which === KEY_CODES.enter) {\n            this.open(event);\n          }\n        });\n      }\n    }\n  }\n\n  let activeDialog = null;\n\n  const open = (dialog, config = CLASS_NAMES) => {\n    const options = Object.assign({}, CLASS_NAMES, config);\n    options.dialog = dialog;\n    options.trigger = config.trigger ? document.getElementById(config.trigger) : false;\n\n    options.isNested = config.isNested || false;\n    options.isOpen = true;\n\n    activeDialog = new Dialog(options);\n    activeDialog.render();\n  };\n\n  const close = () => {\n    activeDialog.close();\n  };\n\n  const render = (selectors = '[data-component=\"dialog\"]', config = CLASS_NAMES) => {\n    const triggers = document.querySelectorAll(selectors);\n    const options = Object.assign({}, CLASS_NAMES, config);\n\n    triggers.forEach((trigger) => {\n      options.trigger = trigger;\n      options.dialog = trigger.dataset.target;\n\n      options.isNested = trigger.dataset.nested === 'true';\n      options.isOpen = trigger.dataset.open === 'true';\n\n      const dialog = new Dialog(options);\n      dialog.render();\n    });\n  };\n\n  return { open, close, render };\n})();\n\nexport default Dialogs;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYTExeS1kaWFsb2ctY29tcG9uZW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7O0FDQUE7OztBQUdBLElBQU0sVUFBVyxZQUFNO0FBQ3JCLE1BQU0sY0FBYztBQUNsQixtQkFBZSxTQURHO0FBRWxCLDBCQUFzQixnQkFGSjtBQUdsQiwyQkFBdUI7QUFITCxHQUFwQjs7QUFNQSxNQUFNLFlBQVk7QUFDaEIsU0FBSyxDQURXO0FBRWhCLFdBQU8sRUFGUztBQUdoQixZQUFRO0FBSFEsR0FBbEI7O0FBTUEsTUFBTSxxQkFBcUIsQ0FDekIsUUFEeUIsRUFFekIsNENBRnlCLEVBR3pCLHdCQUh5QixFQUl6QiwwQkFKeUIsRUFLekIsd0JBTHlCLEVBTXpCLFFBTnlCLEVBT3pCLFFBUHlCLEVBUXpCLE9BUnlCLEVBU3pCLG1CQVR5QixFQVV6QixpQ0FWeUIsQ0FBM0I7O0FBYnFCLE1BMEJmLE1BMUJlO0FBMkJuQixvQkFBWSxPQUFaLEVBQXFCO0FBQUE7O0FBQ25CLFdBQUssT0FBTCxHQUFlLFFBQVEsT0FBdkI7QUFDQSxXQUFLLE1BQUwsR0FBYyxTQUFTLGNBQVQsQ0FBd0IsUUFBUSxNQUFoQyxDQUFkO0FBQ0EsV0FBSyxlQUFMLEdBQXVCLEtBQUssTUFBTCxDQUFZLGdCQUFaLENBQTZCLGdCQUE3QixDQUF2Qjs7QUFFQSxXQUFLLGlCQUFMLEdBQXlCLEtBQUssTUFBTCxDQUFZLGdCQUFaLENBQTZCLGtCQUE3QixDQUF6Qjs7QUFMbUIsOENBTVksS0FBSyxpQkFOakI7O0FBTWxCLFdBQUsscUJBTmE7O0FBT25CLFdBQUssb0JBQUwsR0FBNEIsS0FBSyxpQkFBTCxDQUF1QixLQUFLLGlCQUFMLENBQXVCLE1BQXZCLEdBQWdDLENBQXZELENBQTVCOztBQVBtQixrQ0FTTCxTQUFTLHNCQUFULENBQWdDLFFBQVEsYUFBeEMsQ0FUSzs7QUFBQTs7QUFTbEIs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VyxTQUFTLGdCQUFULENBQTBCLFNBQTFCLENBQWpCO0FBQ0EsUUFBTSxVQUFVLE9BQU8sTUFBUCxDQUFjLEVBQWQsRUFBa0IsV0FBbEIsRUFBK0IsTUFBL0IsQ0FBaEI7O0FBRUEsYUFBUyxPQUFULENBQWlCLFVBQUMsT0FBRCxFQUFhO0FBQzVCLGNBQVEsT0FBUixHQUFrQixPQUFsQjtBQUNBLGNBQVEsTUFBUixHQUFpQixRQUFRLE9BQVIsQ0FBZ0IsTUFBakM7O0FBRUEsY0FBUSxRQUFSLEdBQW1CLFFBQVEsT0FBUixDQUFnQixNQUFoQixLQUEyQixNQUE5QztBQUNBLGNBQVEsTUFBUixHQUFpQixRQUFRLE9BQVIsQ0FBZ0IsSUFBaEIsS0FBeUIsTUFBMUM7O0FBRUEsVUFBTSxTQUFTLElBQUksTUFBSixDQUFXLE9BQVgsQ0FBZjtBQUNBLGFBQU8sTUFBUDtBQUNELEtBVEQ7QUFVRCxHQWREOztBQWdCQSxTQUFPLEVBQUUsVUFBRixFQUFRLFlBQVIsRUFBZSxjQUFmLEVBQVA7QUFDRCxDQWhNZSxFQUFoQjs7a0JBa01lLE8iLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyogZGlhbG9nc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmNvbnN0IERpYWxvZ3MgPSAoKCkgPT4ge1xuICBjb25zdCBDTEFTU19OQU1FUyA9IHtcbiAgICBwYWdlQ2xhc3NOYW1lOiAnanMtcGFnZScsXG4gICAgaW5lcnRMYXllcnNDbGFzc05hbWU6ICdqcy1pbmVydC1sYXllcicsXG4gICAgZGlzYWJsZWRQYWdlQ2xhc3NOYW1lOiAnaXMtaW5hY3RpdmUnLFxuICB9O1xuXG4gIGNvbnN0IEtFWV9DT0RFUyA9IHtcbiAgICB0YWI6IDksXG4gICAgZW50ZXI6IDEzLFxuICAgIGVzY2FwZTogMjcsXG4gIH07XG5cbiAgY29uc3QgRk9DVVNBQkxFX0VMRU1FTlRTID0gW1xuICAgICdbaHJlZl0nLFxuICAgICdpbnB1dDpub3QoW2Rpc2FibGVkXSk6bm90KFt0eXBlPVwiaGlkZGVuXCJdKScsXG4gICAgJ3NlbGVjdDpub3QoW2Rpc2FibGVkXSknLFxuICAgICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSknLFxuICAgICdidXR0b246bm90KFtkaXNhYmxlZF0pJyxcbiAgICAnaWZyYW1lJyxcbiAgICAnb2JqZWN0JyxcbiAgICAnZW1iZWQnLFxuICAgICdbY29udGVudGVkaXRhYmxlXScsXG4gICAgJ1t0YWJpbmRleF06bm90KFt0YWJpbmRleF49XCItXCJdKScsXG4gIF07XG5cbiAgY2xhc3MgRGlhbG9nIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgICB0aGlzLnRyaWdnZXIgPSBvcHRpb25zLnRyaWdnZXI7XG4gICAgICB0aGlzLmRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9wdGlvbnMuZGlhbG9nKTtcbiAgICAgIHRoaXMuZGlzbWlzc1RyaWdnZXJzID0gdGhpcy5kaWFsb2cucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZGlzbWlzc10nKTtcblxuICAgICAgdGhpcy5mb2N1c2FibGVFbGVtZW50cyA9IHRoaXMuZGlhbG9nLnF1ZXJ5U2VsZWN0b3JBbGwoRk9DVVNBQkxFX0VMRU1FTlRTKTtcbiAgICAgIFt0aGlzLmZpcnN0Rm9jdXNhYmxlRWxlbWVudF0gPSB0aGlzLmZvY3VzYWJsZUVsZW1lbnRzO1xuICAgICAgdGhpcy5sYXN0Rm9jdXNhYmxlRWxlbWVudCA9IHRoaXMuZm9jdXNhYmxlRWxlbWVudHNbdGhpcy5mb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLSAxXTtcblxuICAgICAgW3RoaXMucGFnZV0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKG9wdGlvbnMucGFnZUNsYXNzTmFtZSk7XG4gICAgICB0aGlzLmluZXJ0TGF5ZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShvcHRpb25zLmluZXJ0TGF5ZXJzQ2xhc3NOYW1lKTtcbiAgICAgIHRoaXMuZGlzYWJsZWRQYWdlQ2xhc3NOYW1lID0gb3B0aW9ucy5kaXNhYmxlZFBhZ2VDbGFzc05hbWU7XG5cbiAgICAgIHRoaXMuaXNOZXN0ZWQgPSBvcHRpb25zLmlzTmVzdGVkO1xuICAgICAgdGhpcy5pc09wZW4gPSBvcHRpb25zLmlzT3BlbjtcblxuICAgICAgdGhpcy5vcGVuID0gdGhpcy5vcGVuLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLmNsb3NlID0gdGhpcy5jbG9zZS5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5vbkNsaWNrID0gdGhpcy5vbkNsaWNrLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLm9uS2V5ZG93biA9IHRoaXMub25LZXlkb3duLmJpbmQodGhpcyk7XG5cbiAgICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb2N1c1RyYXAoZXZlbnQpIHtcbiAgICAgIGlmIChldmVudC5zaGlmdEtleSAmJiBldmVudC50YXJnZXQgPT09IHRoaXMuZmlyc3RGb2N1c2FibGVFbGVtZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMubGFzdEZvY3VzYWJsZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFldmVudC5zaGlmdEtleSAmJiBldmVudC50YXJnZXQgPT09IHRoaXMubGFzdEZvY3VzYWJsZUVsZW1lbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5maXJzdEZvY3VzYWJsZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRGb2N1cygpIHtcbiAgICAgIGlmICh0aGlzLmZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZmlyc3RGb2N1c2FibGVFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgIH0sIDEwMCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgb3BlbihldmVudCkge1xuICAgICAgaWYgKGV2ZW50KSBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICB0aGlzLmRpYWxvZy5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJyk7XG5cbiAgICAgIGlmICghdGhpcy5pc05lc3RlZCkge1xuICAgICAgICB0aGlzLnBhZ2UuY2xhc3NMaXN0LmFkZCh0aGlzLmRpc2FibGVkUGFnZUNsYXNzTmFtZSk7XG5cbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbCh0aGlzLmluZXJ0TGF5ZXJzLCAoaW5lcnRMYXllcikgPT4ge1xuICAgICAgICAgIGluZXJ0TGF5ZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgICAgIGluZXJ0TGF5ZXIuc2V0QXR0cmlidXRlKCdpbmVydCcsICcnKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIHNldHRpbmcgZm9jdXMgb24gdGhlIGZpcnN0IGZvY3VzYWJsZSBlbGVtZW50XG4gICAgICB0aGlzLnNldEZvY3VzKCk7XG5cbiAgICAgIC8vIGFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBjbG9zZShldmVudCkge1xuICAgICAgaWYgKGV2ZW50KSBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICB0aGlzLmRpYWxvZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG5cbiAgICAgIGlmICghdGhpcy5pc05lc3RlZCkge1xuICAgICAgICB0aGlzLnBhZ2UuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmRpc2FibGVkUGFnZUNsYXNzTmFtZSk7XG5cbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbCh0aGlzLmluZXJ0TGF5ZXJzLCAoaW5lcnRMYXllcikgPT4ge1xuICAgICAgICAgIGluZXJ0TGF5ZXIucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWhpZGRlbicpO1xuICAgICAgICAgIGluZXJ0TGF5ZXIucmVtb3ZlQXR0cmlidXRlKCdpbmVydCcpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gcmVzdG9yaW5nIGZvY3VzXG4gICAgICBpZiAodGhpcy50cmlnZ2VyKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlci5mb2N1cygpO1xuICAgICAgfVxuXG4gICAgICAvLyByZW1vdmUgZXZlbnQgbGlzdGVuZXJzXG4gICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XG4gICAgfVxuXG4gICAgYWRkRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICB0aGlzLmRpYWxvZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljayk7XG4gICAgICB0aGlzLmRpYWxvZy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkNsaWNrKTtcbiAgICAgIHRoaXMuZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLm9uS2V5ZG93bik7XG4gICAgICB0aGlzLmRpc21pc3NUcmlnZ2Vycy5mb3JFYWNoKChkaXNtaXNzVHJpZ2dlcikgPT4ge1xuICAgICAgICBkaXNtaXNzVHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xvc2UpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICB0aGlzLmRpYWxvZy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljayk7XG4gICAgICB0aGlzLmRpYWxvZy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkNsaWNrKTtcbiAgICAgIHRoaXMuZGlhbG9nLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLm9uS2V5ZG93bik7XG4gICAgICB0aGlzLmRpc21pc3NUcmlnZ2Vycy5mb3JFYWNoKChkaXNtaXNzVHJpZ2dlcikgPT4ge1xuICAgICAgICBkaXNtaXNzVHJpZ2dlci5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xvc2UpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25DbGljayhldmVudCkge1xuICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhpcy5kaWFsb2cpIHRoaXMuY2xvc2UoZXZlbnQpO1xuICAgIH1cblxuICAgIG9uS2V5ZG93bihldmVudCkge1xuICAgICAgaWYgKGV2ZW50LndoaWNoID09PSBLRVlfQ09ERVMuZXNjYXBlKSB0aGlzLmNsb3NlKGV2ZW50KTtcbiAgICAgIGlmIChldmVudC53aGljaCA9PT0gS0VZX0NPREVTLmVudGVyICYmIGV2ZW50LnRhcmdldC5oYXNBdHRyaWJ1dGUoJ2RhdGEtZGlzbWlzcycpKSB0aGlzLmNsb3NlKGV2ZW50KTtcbiAgICAgIGlmIChldmVudC53aGljaCA9PT0gS0VZX0NPREVTLnRhYikgdGhpcy5mb2N1c1RyYXAoZXZlbnQpO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgIGlmICh0aGlzLnRyaWdnZXIpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vcGVuKTtcbiAgICAgICAgdGhpcy50cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IEtFWV9DT0RFUy5lbnRlcikge1xuICAgICAgICAgICAgdGhpcy5vcGVuKGV2ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxldCBhY3RpdmVEaWFsb2cgPSBudWxsO1xuXG4gIGNvbnN0IG9wZW4gPSAoZGlhbG9nLCBjb25maWcgPSBDTEFTU19OQU1FUykgPT4ge1xuICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBDTEFTU19OQU1FUywgY29uZmlnKTtcbiAgICBvcHRpb25zLmRpYWxvZyA9IGRpYWxvZztcbiAgICBvcHRpb25zLnRyaWdnZXIgPSBjb25maWcudHJpZ2dlciA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbmZpZy50cmlnZ2VyKSA6IGZhbHNlO1xuXG4gICAgb3B0aW9ucy5pc05lc3RlZCA9IGNvbmZpZy5pc05lc3RlZCB8fCBmYWxzZTtcbiAgICBvcHRpb25zLmlzT3BlbiA9IHRydWU7XG5cbiAgICBhY3RpdmVEaWFsb2cgPSBuZXcgRGlhbG9nKG9wdGlvbnMpO1xuICAgIGFjdGl2ZURpYWxvZy5yZW5kZXIoKTtcbiAgfTtcblxuICBjb25zdCBjbG9zZSA9ICgpID0+IHtcbiAgICBhY3RpdmVEaWFsb2cuY2xvc2UoKTtcbiAgfTtcblxuICBjb25zdCByZW5kZXIgPSAoc2VsZWN0b3JzID0gJ1tkYXRhLWNvbXBvbmVudD1cImRpYWxvZ1wiXScsIGNvbmZpZyA9IENMQVNTX05BTUVTKSA9PiB7XG4gICAgY29uc3QgdHJpZ2dlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycyk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIENMQVNTX05BTUVTLCBjb25maWcpO1xuXG4gICAgdHJpZ2dlcnMuZm9yRWFjaCgodHJpZ2dlcikgPT4ge1xuICAgICAgb3B0aW9ucy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICAgIG9wdGlvbnMuZGlhbG9nID0gdHJpZ2dlci5kYXRhc2V0LnRhcmdldDtcblxuICAgICAgb3B0aW9ucy5pc05lc3RlZCA9IHRyaWdnZXIuZGF0YXNldC5uZXN0ZWQgPT09ICd0cnVlJztcbiAgICAgIG9wdGlvbnMuaXNPcGVuID0gdHJpZ2dlci5kYXRhc2V0Lm9wZW4gPT09ICd0cnVlJztcblxuICAgICAgY29uc3QgZGlhbG9nID0gbmV3IERpYWxvZyhvcHRpb25zKTtcbiAgICAgIGRpYWxvZy5yZW5kZXIoKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4geyBvcGVuLCBjbG9zZSwgcmVuZGVyIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBEaWFsb2dzO1xuIl19"}